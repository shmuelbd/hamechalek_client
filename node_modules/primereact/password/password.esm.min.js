import*as e from"react";import t,{PrimeReactContext as n,localeOption as r}from"primereact/api";import{CSSTransition as o}from"primereact/csstransition";import{useOverlayListener as l,useUnmountEffect as i}from"primereact/hooks";import{EyeIcon as a}from"primereact/icons/eye";import{EyeSlashIcon as u}from"primereact/icons/eyeslash";import{InputText as c}from"primereact/inputtext";import{OverlayService as p}from"primereact/overlayservice";import{Portal as s}from"primereact/portal";import{ObjectUtils as f,DomHandler as m,ZIndexUtils as d,classNames as y,mergeProps as g,IconUtils as b}from"primereact/utils";import{ComponentBase as v}from"primereact/componentbase";function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function h(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function E(e){var t=h(e,"string");return"symbol"===w(t)?t:String(t)}function S(e){if(Array.isArray(e))return e}function O(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function R(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){return S(e)||O(e,t)||k(e,t)||R()}var N=v.extend({defaultProps:{__TYPE:"Password",id:null,inputId:null,inputRef:null,promptLabel:null,weakLabel:null,mediumLabel:null,strongLabel:null,mediumRegex:"^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})",strongRegex:"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})",feedback:!0,toggleMask:!1,appendTo:null,header:null,content:null,footer:null,showIcon:null,hideIcon:null,icon:null,tooltip:null,tooltipOptions:null,style:null,className:null,inputStyle:null,inputClassName:null,panelStyle:null,panelClassName:null,transitionOptions:null,onInput:null,onShow:null,onHide:null,children:void 0}});function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){var r,o,l;r=e,l=n[t],(o=E(o=t))in r?Object.defineProperty(r,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[o]=l})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=e.memo(e.forwardRef((function(v,w){var h=e.useContext(n),E=N.getProps(v,h),S=E.promptLabel||r("passwordPrompt"),O=E.weakLabel||r("weak"),x=E.mediumLabel||r("medium"),k=E.strongLabel||r("strong"),R=I(e.useState(!1),2),j=R[0],C=R[1],T=I(e.useState(null),2),A=T[0],L=T[1],M=I(e.useState(S),2),z=M[0],D=M[1],J=I(e.useState(!1),2),X=J[0],Z=J[1],F=I(e.useState(!1),2),H=F[0],U=F[1],B=e.useRef(null),K=e.useRef(null),V=e.useRef(E.inputRef),_=e.useRef(new RegExp(E.mediumRegex)),Y=e.useRef(new RegExp(E.strongRegex)),$=H?"text":"password",q=N.setMetaData({props:E,state:{overlayVisible:j,meter:A,infoText:z,focused:X,unmasked:H}}).ptm,G=I(l({target:B,overlay:K,listener:function(e,t){t.valid&&ie()},when:j}),2),Q=G[0],W=G[1],ee=V.current&&V.current.value,te=e.useMemo((function(){return f.isNotEmpty(E.value)||f.isNotEmpty(E.defaultValue)||f.isNotEmpty(ee)}),[E.value,E.defaultValue,ee]),ne=function(){if(A){var e=null;switch(A.strength){case"weak":e=O;break;case"medium":e=x;break;case"strong":e=k}e&&z!==e&&D(e)}else z!==S&&D(S)},re=function(e){E.feedback&&p.emit("overlay-click",{originalEvent:e,target:B.current})},oe=function(){U((function(e){return!e}))},le=function(){ne(),C(!0)},ie=function(){C(!1)},ae=function(){d.set("overlay",K.current,h&&h.autoZIndex||t.autoZIndex,h&&h.zIndex.overlay||t.zIndex.overlay),V.current&&m.alignOverlay(K.current,V.current.parentElement,E.appendTo||h&&h.appendTo||t.appendTo)},ue=function(){Q(),E.onShow&&E.onShow()},ce=function(){W()},pe=function(){d.clear(K.current),E.onHide&&E.onHide()},se=function(e){return Y.current.test(e)?3:_.current.test(e)?2:e.length?1:0};e.useImperativeHandle(w,(function(){return{props:E,focus:function(){return m.focus(V.current)},getElement:function(){return B.current},getOverlay:function(){return K.current},getInput:function(){return V.current}}})),e.useEffect((function(){f.combinedRefs(V,E.inputRef)}),[V,E.inputRef]),e.useEffect((function(){_.current=new RegExp(E.mediumRegex)}),[E.mediumRegex]),e.useEffect((function(){Y.current=new RegExp(E.strongRegex)}),[E.strongRegex]),e.useEffect((function(){!te&&m.hasClass(B.current,"p-inputwrapper-filled")&&m.removeClass(B.current,"p-inputwrapper-filled")}),[te]),i((function(){d.clear(K.current)}));var fe,me,de,ye,ge,be,ve,we,he,Ee,Se,Oe=y("p-password p-component p-inputwrapper",{"p-inputwrapper-filled":te,"p-inputwrapper-focus":X,"p-input-icon-right":E.toggleMask},E.className),xe=y("p-password-input",E.inputClassName),ke=N.getOtherProps(E),Re=function(){var t=g(q("hideIcon")),n=g(q("showIcon")),r=b.getJSXIcon(H?E.hideIcon||e.createElement(u,t):E.showIcon||e.createElement(a,n),P({},H?t:n),{props:E});if(E.toggleMask){var o=e.createElement("i",{onClick:oe}," ",r," ");if(E.icon)o=f.getJSXElement(E.icon,{onClick:oe,className:Oe,element:o,props:E});return o}return null}(),Ie=(fe=y("p-password-panel p-component",E.panelClassName,{"p-input-filled":h&&"filled"===h.inputStyle||"filled"===t.inputStyle,"p-ripple-disabled":h&&!1===h.ripple||!1===t.ripple}),de=(me=A||{strength:"",width:"0%"}).strength,ye=me.width,ge=f.getJSXElement(E.header,E),be=f.getJSXElement(E.footer,E),ve=g({ref:K,className:fe,style:E.panelStyle,onClick:re},q("panel")),we=g({className:"p-password-meter"},q("meter")),he=g({className:"p-password-strength ".concat(de),style:{width:ye}},q("meterLabel")),Ee=g({className:"p-password-info ".concat(de)},q("info")),Se=E.content?f.getJSXElement(E.content,E):e.createElement(e.Fragment,null,e.createElement("div",we,e.createElement("div",he)),e.createElement("div",Ee,z)),e.createElement(s,{element:e.createElement(o,{nodeRef:K,classNames:"p-connected-overlay",in:j,timeout:{enter:120,exit:100},options:E.transitionOptions,unmountOnExit:!0,onEnter:ae,onEntered:ue,onExit:ce,onExited:pe},e.createElement("div",ve,ge,Se,be)),appendTo:E.appendTo})),Ne=g({ref:B,id:E.id,className:Oe,style:E.style},N.getOtherProps(E),q("root")),je=g(P(P({ref:V,id:E.inputId},ke),{},{type:$,className:xe,style:E.inputStyle,onFocus:function(e){Z(!0),E.feedback&&le(),E.onFocus&&E.onFocus(e)},onBlur:function(e){Z(!1),E.feedback&&ie(),E.onBlur&&E.onBlur(e)},onKeyUp:function(e){var t=e.keyCode||e.which;if(E.feedback){var n=null,r=null;switch(se(e.target.value)){case 1:n=O,r={strength:"weak",width:"33.33%"};break;case 2:n=x,r={strength:"medium",width:"66.66%"};break;case 3:n=k,r={strength:"strong",width:"100%"};break;default:n=S,r=null}L(r),D(n),t&&!j&&le()}E.onKeyUp&&E.onKeyUp(e)},onInput:function(e,t){E.onInput&&E.onInput(e,t),E.onChange||(f.isNotEmpty(e.target.value)?m.addClass(B.current,"p-inputwrapper-filled"):m.removeClass(B.current,"p-inputwrapper-filled"))},tooltip:E.tooltip,tooltipOptions:E.tooltipOptions}),q("input"));return e.createElement("div",Ne,e.createElement(c,je),Re,Ie)})));C.displayName="Password";export{C as Password};
